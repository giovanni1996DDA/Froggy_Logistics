CREATE DATABASE Services;
GO
USE Services;
GO

-- Tabla: Permiso
CREATE TABLE Permiso (
    ID_Permiso UNIQUEIDENTIFIER PRIMARY KEY,
    Codigo_Permiso INT IDENTITY(1,1) UNIQUE,
    Nombre NVARCHAR(100) NOT NULL,
    Descripcion NVARCHAR(200),
    Formulario NVARCHAR(100)
);

-- Tabla: Rol
CREATE TABLE Rol (
    ID_Rol UNIQUEIDENTIFIER PRIMARY KEY,
    Codigo_Rol INT IDENTITY(1,1) UNIQUE,
    Nombre NVARCHAR(100) NOT NULL,
    Descripcion NVARCHAR(200)
);

-- Tabla: RolRolRelation
CREATE TABLE RolRolRelation (
    ID_Rol_Padre UNIQUEIDENTIFIER,
    ID_Rol_Hijo UNIQUEIDENTIFIER,
    PRIMARY KEY (ID_Rol_Padre, ID_Rol_Hijo),
    FOREIGN KEY (ID_Rol_Padre) REFERENCES Rol(ID_Rol),
    FOREIGN KEY (ID_Rol_Hijo) REFERENCES Rol(ID_Rol)
);

-- Tabla: RolPermisoRelation
CREATE TABLE RolPermisoRelation (
    ID_Rol UNIQUEIDENTIFIER,
    ID_Permiso UNIQUEIDENTIFIER,
    PRIMARY KEY (ID_Rol, ID_Permiso),
    FOREIGN KEY (ID_Rol) REFERENCES Rol(ID_Rol),
    FOREIGN KEY (ID_Permiso) REFERENCES Permiso(ID_Permiso)
);

-- Tabla: TipoDocumento
CREATE TABLE TipoDocumento (
    ID_TipoDocumento INT PRIMARY KEY,
    Nombre NVARCHAR(50)
);

-- Tabla: Usuario
CREATE TABLE Usuario (
    ID_Usuario UNIQUEIDENTIFIER PRIMARY KEY,
    Legajo INT IDENTITY(1,1) UNIQUE,
    Usuario NVARCHAR(50) NOT NULL,
    Contrase√±a NVARCHAR(255) NOT NULL,
    Email NVARCHAR(100),
    Nombre NVARCHAR(100),
    ID_TipoDocumento INT,
    NumeroDocumento NVARCHAR(50),
    FOREIGN KEY (ID_TipoDocumento) REFERENCES TipoDocumento(ID_TipoDocumento)
);

-- Tabla: UsuarioRolRelation
CREATE TABLE UsuarioRolRelation (
    ID_Usuario UNIQUEIDENTIFIER,
    ID_Rol UNIQUEIDENTIFIER,
    PRIMARY KEY (ID_Usuario, ID_Rol),
    FOREIGN KEY (ID_Usuario) REFERENCES Usuario(ID_Usuario),
    FOREIGN KEY (ID_Rol) REFERENCES Rol(ID_Rol)
);


-- Tabla: UsuarioPermisoRelation
CREATE TABLE UsuarioPermisoRelation (
    ID_Usuario UNIQUEIDENTIFIER,
    ID_Permiso UNIQUEIDENTIFIER,
    PRIMARY KEY (ID_Usuario, ID_Permiso),
    FOREIGN KEY (ID_Usuario) REFERENCES Usuario(ID_Usuario),
    FOREIGN KEY (ID_Permiso) REFERENCES Permiso(ID_Permiso)
);
